<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=preconnect href=https://fonts.googleapis.com crossorigin><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&display=swap"><link rel=stylesheet type=text/css href=/css/style.min.d7963e9ac464f53a44d64147c8d59104542dd77f291506a1e62052565c344757.css><title>Building a Tag Cloud for Category Pages [cathelijne.github.io]</title><meta name=description content="[cathelijne.github.io] - Building a Tag Cloud for Category Pages
  I wanted to include a tag list on my category pages that only shows the tags that are actually present in [pages in] the category shown. I found a few topics on Hugo's discourse, but no real answers. In the end, it wasn't so hard, but as a new Hugo user, dealing with the context shift is a bit of a learning curve. It took me a while to figure out why my tags showed inside my range, but not outside."><meta name=keywords content="hugo,theDot,templates,go"><style type=text/css media=screen>.hero,header{background-image:linear-gradient(transparent,rgba(0,0,0,.5)),url(/media/cloud1.jpg);background-image:linear-gradient(transparent,rgba(0,0,0,.5)),image-set( url(/media/cloud1_hu8e75b88845596171585156eb3f7ec41d_5310375_800x0_resize_q80_h2_lanczos.webp) 1x,url(/media/cloud1_hu8e75b88845596171585156eb3f7ec41d_5310375_1600x0_resize_q80_h2_lanczos.webp) 2x );background-image:linear-gradient(transparent,rgba(0,0,0,.5)),-webkit-image-set( url(/media/cloud1_hu8e75b88845596171585156eb3f7ec41d_5310375_800x0_resize_q80_h2_lanczos.webp) 1x,url(/media/cloud1_hu8e75b88845596171585156eb3f7ec41d_5310375_1600x0_resize_q80_h2_lanczos.webp) 2x )}</style></head><body><header class="hero noprint"></header><div class=columns><div class=column><nav class=noprint><ul><li class=sticky><a href=/ title=home>home</a></li><li class=sticky><a href=/about title=about>about</a></li><li class=sticky><a href=/cv title=cv>cv</a></li></ul></nav><div class=content><div><h1>Building a Tag Cloud for Category Pages</h1></div><div class="columns mx-4"><div class=row><div class="col-1 noprint"></div><div class=col><div class=introduction><div><p><em>I wanted to include a tag list on my category pages that only shows the tags that are actually present in [pages in] the category shown. I found a few topics on Hugo&rsquo;s discourse, but no real answers. In the end, it wasn&rsquo;t so hard, but as a new Hugo user, dealing with the context shift is a bit of a learning curve. It took me a while to figure out why my tags showed inside my range, but not outside.</em></p></div></div><h2 id=tldr>TL;DR:</h2><pre tabindex=0><code>&lt;!-- Get the tags for all the pages the current context --&gt;
{{ $.Scratch.Set &#34;tags&#34; (slice) }}
{{ range .Data.Pages }}
  {{ range .Params.tags }}
    {{ $.Scratch.Add &#34;tags&#34; . }}
  {{end}}
{{end}}

&lt;!-- Get all tags and show only the ones we grabbed in the step above --&gt;
{{ range .Site.Taxonomies.tags.ByCount }}
  {{ if in ($.Scratch.Get &#34;tags&#34; |sort |uniq) .Name }}
    &lt;a href=&#34;{{ .Page.Permalink }}&#34;&gt;{{ .Page.Title }}&lt;/a&gt; {{ .Count }}
  {{ end }}
{{ end }}
</code></pre><h2 id=how-i-got-here>How I got here</h2><p>We need to deal with Hugo&rsquo;s context shift. I found <a href=https://www.regisphilibert.com/blog/2018/02/hugo-the-scope-the-context-and-the-dot/>this article</a> very helpful in explaining what happens, but the author mostly talks about passing variables <em>down</em>, and I wanted my tags to go <em>up</em>!</p><h3 id=scratch>.Scratch</h3><p>In the Hugo docs, <a href=https://gohugo.io/functions/scratch/><code>.Scratch</code></a> is described as:</p><blockquote><p><code>.Scratch</code> is available as a Page method or a Shortcode method and attaches the “scratched” data to the given page. Either a Page or a Shortcode context is required to use <code>.Scratch</code> .</p></blockquote><p>Cool! So <code>.Scratch</code> attaches to the page I&rsquo;m working on, and I can now update <code>.Scratch</code>, and it will work! No?
Ehhh, no. Actually, it doesn&rsquo;t work that way. It took me quite a bit longer than I care to admit that &ldquo;page&rdquo; refers to something in the current context than and not the Category page that will eventually get rendered by Hugo. So if I call .Scratch as the first thing, it&rsquo;s at the root of my page. If I call it inside <code>range .Data.Pages</code>, <code>.Scratch</code> will live there, and f I call it in the second range, it will live there. And for every time <code>range</code> loops over an item, I will get a new <code>.Scratch</code>. Empty. Once <strong>that</strong> sank in, I understood why my slice ended up empty, and the solution wasn&rsquo;t too hard to find.</p><h3 id=just-give-it-a-dollar>Just give it a dollar!</h3><p>In the article I mentioned above, there&rsquo;s a section about the top level context, and how it&rsquo;s attached to <code>$</code>. So I added a dollar sign in front of my <code>.Scratch</code>, like so: <code>$.Scratch</code>, and lo and behold, it got filled round after round while <code>range</code> looped over all the pages in my category. Hurray!</p><h3 id=getting-the-links-to-tags>Getting the links to tags</h3><p>This was easy. I started by assembling all the tags in the site (<code>range .Site.Taxonomies.tags.ByCount</code>). First I thought it was a good idea to get their names and intersect those with the list I had in my <code>.Scratch</code>, but then I realised I still had to look up the page objects in <code>.Site.Taxonomies.tags.ByCount</code> to get the links to the tags, and was doing the same thing twice. All I needed was to check if the objects name was in my scratched list, and get the title and link. the <code>in</code> function did the trick.</p><p>And there it is, a tag list for the current category. A lot of learning went into those few lines of code.</p><h2 id=afterthoughts>Afterthoughts</h2><h3 id=pages-and-dollars>Pages and dollars</h3><p>I was seriously thrown off by the meaning of <em>Page</em> and <em>Pages</em>. Finding that explanation of the $ really helped a lot. I&rsquo;m sure it&rsquo;s in the docs somewhere, and once you know it, it&rsquo;s unlikely you&rsquo;ll ever forget, but for newbies like me it isn&rsquo;t an obvious thing.</p><h3 id=you-actually-dont-need-scratch-or-scratch-if-you-use-a-recent-version-of-hugo>You actually don&rsquo;t need .Scratch (or $.Scratch) if you use a recent version of Hugo</h3><p>Hugo now supports $variables in templates, so you could use those as well. However, I think using <code>.Scratch</code> and <code>$.Scratch</code> isn&rsquo;t a bad thing. Having to add that dollar or not really makes you think about the scope, and also gives an immediate visual clue. I&rsquo;m a sysadmin and cloud engineer and have used a lot of Bash, zsh and Python. Hugo scoping is a bit different, and that dollar sure helps!</p></div></div></div><footer><div>Copyright © 2023 Cathelijne Hornstra</div><nav class="home social"><ul><li class=sticky><a href=mailto:websitemessage@hornstra.com title=mail><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M0 128C0 92.65 28.65 64 64 64H448c35.3.0 64 28.65 64 64V384c0 35.3-28.7 64-64 64H64c-35.35.0-64-28.7-64-64V128zm48 0v22.1L220.5 291.7c20.6 17 50.4 17 71 0L464 150.1v-23C464 119.2 456.8 111.1 448 111.1H64C55.16 111.1 48 119.2 48 127.1V128zm0 84.2V384C48 392.8 55.16 4e2 64 4e2H448C456.8 4e2 464 392.8 464 384V212.2L322 328.8c-38.4 31.5-93.6 31.5-132.9.0L48 212.2z"/></svg></a></li><li class=sticky><a href=https://github.com/cathelijne title=github><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8.0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8.0-21.5 4.9-32.3 14.6-51.8 45.3.0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8.0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9.0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2.0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8.0-73.5 38.7-73.5 82.6.0 87.8 80.4 101.3 150.4 101.3h48.2c70.3.0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8.0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg></a></li><li class=sticky><a href=https://mastodon.nl/@lijn rel=me title=mastodon><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48.0.0.0-63.72 28.5-63.72 125.7.0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54.0 01-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg></a></li><li class=sticky><a href=https://linkedin.com/in/cathelijne title=linkedin><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5.0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6.0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3.0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2.0 38.5 17.3 38.5 38.5.0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6.0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2.0 79.7 44.3 79.7 101.9V416z"/></svg></a></li></ul></nav></footer></div></div><script data-goatcounter=https://pepperlink.goatcounter.com/count async src=//gc.zgo.at/count.js></script><noscript><img src="https://pepperlink.goatcounter.com/count?p=pixel&t=pixel"></noscript></body></html>